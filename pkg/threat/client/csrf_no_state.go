package threat

import (
	"net/http"
	"oauth2-pentester/pkg/derror"
)

type CSRFNoState struct {
	baseThreat
}

func NewCSRFNoState(authURL string, client *http.Client) *CSRFNoState {
	threat := new(CSRFNoState)
	threat.authURL = authURL
	threat.client = client

	return threat
}

func (t *CSRFNoState) Analyze() (bool, derror.Error) {
	authURL, err := t.getAuthURL()
	if err != nil {
		return false, err
	}

	if authURL.Query().Get(stateParam) == "" {
		return false, nil
	}

	return true, nil
}

func (t *CSRFNoState) String() string {
	return "CSRF. Клиент не использует state"
}

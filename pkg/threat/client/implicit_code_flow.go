package threat

import (
	"net/http"
	"oauth2-pentester/pkg/derror"
)

type ImplicitCodeFlow struct {
	baseThreat
}

func NewImplicitCodeFlow(authURL string, client *http.Client) *ImplicitCodeFlow {
	threat := new(ImplicitCodeFlow)
	threat.authURL = authURL
	threat.client = client

	return threat
}

func (t *ImplicitCodeFlow) Analyze() (bool, derror.Error) {
	authURL, err := t.getAuthURL()
	if err != nil {
		return false, err
	}

	if authURL.Query().Get(responseTypeParam) != grantResponseType {
		return false, nil
	}

	return true, nil
}

func (t *ImplicitCodeFlow) String() string {
	return "Implicit code flow"
}

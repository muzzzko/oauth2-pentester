package threat

import (
	"net/http"
	"oauth2-pentester/pkg/derror"
)

type IncreaseScope struct {
	baseThreat

	clientID            string
	clientSecret        string
	scope 			    string

	client *http.Client
}

func NewincreaseScope(
	authURL,
	username,
	password,
	tokenURL,
	clientID,
	clientSecret,
	scope,
	elementEmailName,
	elementPassName,
	elementEnterID string,
	client *http.Client) *IncreaseScope {

	threat := new(IncreaseScope)
	threat.authURL = authURL
	threat.username = username
	threat.password = password
	threat.tokenURL = tokenURL
	threat.clientID = clientID
	threat.clientSecret = clientSecret
	threat.scope = scope
	threat.elementEmailName = elementEmailName
	threat.elementPassName = elementPassName
	threat.elementEnterID = elementEnterID
	threat.client = client

	return threat
}

func (t *IncreaseScope) Analyze() (bool, derror.Error) {
	vcreds, err := t.auth(t.clientID, t.clientSecret, t.scope)
	if err != nil {
		return false, err
	}

	if vcreds.AccessToken != "" {
		return false, nil
	}

	return true, nil
}

func (t *IncreaseScope) String() string {
	return "Повышение прав доступа выданных пользователем клиенту"
}

